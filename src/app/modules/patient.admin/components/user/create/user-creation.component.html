<ngx-spinner></ngx-spinner>
<c-callout color="danger" *ngIf="isValidForm">
    <span class="text-danger fw-bold">Please fill in all the required fields before submitting user</span>
</c-callout>
<form [formGroup]="userForm">
    <!--User-->
    <c-row>
        <c-col xs="12"><label style="width: 150px;">User Name<span class="text-danger">*</span></label></c-col>
        <c-col xs="12">
            <input class="form-control" placeholder formControlName="username" sizing="sm" cFormControl [ngClass]="{'is-invalid': this.userForm.get('username')?.invalid
            && this.userForm.get('username')?.touched}" maxlength="60" input-trimmer>
        </c-col>
        <c-col xs="12">
            <div *ngIf="this.userForm.get('username')?.errors?.['required'] && 
        (this.userForm.get('username')?.dirty ||this.userForm.get('username')?.touched)" class="text-danger mx-1">
                User Name is required
            </div>
            <div *ngIf="this.userForm.get('username')?.errors?.['noSpecialCharacters']" class="text-danger mx-1">
                User Name cannot contain special characters.</div>
            <span *ngIf="validUserName">
                <label>
                    <span class="text-success">Typed user name is unique</span>
                    <svg cIcon name="cilCheck" cTextColor="success" size="lg"></svg>
                </label>
            </span>
            <span *ngIf="validUserName === false">
                <label>
                    {{validUserNameMessage}}
                    <svg cIcon name="cilReportSlash" cTextColor="danger" size="lg"></svg>
                </label>
            </span>
        </c-col>
    </c-row>
    <!--First Name-->
    <c-row>
        <c-col xs="12">
            <label style="width: 150px;">First Name<span class="text-danger">*</span></label>
        </c-col>
        <c-col xs="12">
            <input class="form-control" placeholder formControlName="firstName" sizing="sm" cFormControl [ngClass]="{'is-invalid': this.userForm.get('firstName')?.invalid
        && this.userForm.get('firstName')?.touched}" maxlength="60" input-trimmer>
        </c-col>
        <c-col xs="12">
            <div *ngIf="this.userForm.get('firstName')?.errors?.['required'] && 
        (this.userForm.get('firstName')?.dirty ||this.userForm.get('firstName')?.touched)" class="text-danger mx-1">
                First Name is required
            </div>
            <div *ngIf="this.userForm.get('firstName')?.errors?.['noSpecialCharacters']" class="text-danger mx-1">
                First Name cannot contain special characters.</div>
        </c-col>
    </c-row>
    <!--Last Name-->
    <c-row>
        <c-col xs="12">
            <label style="width: 150px;">Last Name<span class="text-danger">*</span></label>
        </c-col>
        <c-col xs="12">
            <input class="form-control" placeholder formControlName="lastName" sizing="sm" cFormControl [ngClass]="{'is-invalid': this.userForm.get('lastName')?.invalid
        && this.userForm.get('lastName')?.touched}" maxlength="60" input-trimmer>
        </c-col>
        <c-col xs="12">
            <div *ngIf="this.userForm.get('lastName')?.errors?.['required'] && 
        (this.userForm.get('lastName')?.dirty ||this.userForm.get('lastName')?.touched)" class="text-danger mx-1">
                Last Name is required
            </div>
            <div *ngIf="this.userForm.get('lastName')?.errors?.['noSpecialCharacters']" class="text-danger mx-1">
                Last Name cannot contain special characters.</div>
        </c-col>
    </c-row>
    <!--Email-->
    <c-row class="mb-2">
        <c-col xs="12">
            <label style="width: 150px;">Email<span class="text-danger">*</span></label>
        </c-col>
        <c-col xs="12">
            <input cFormControl sizing="sm" class="form-control" placeholder formControlName="email" [ngClass]="{'is-invalid': this.userForm.get('email')?.invalid
        && this.userForm.get('email')?.touched}" maxlength="60" [readonly]="mode ==='edit'" input-trimmer>
        </c-col>
        <c-col xs="12">
            <div *ngIf="this.userForm.get('email')?.errors?.['required'] === true && 
        (this.userForm.get('email')?.dirty ||this.userForm.get('email')?.touched)" class="text-danger mx-1">
                Email Required
            </div>
            <div *ngIf="this.userForm.get('email')?.errors?.['email'] === true" class="text-danger mx-1">
                Invalid Email
            </div>
            <span *ngIf="validEmail">
                <label>
                    <svg cIcon name="cilCheck" cTextColor="success" size="lg"></svg>
                </label>
            </span>
            <span *ngIf="validEmail === false">
                <label>
                    {{validEmailMessage}}
                    <svg cIcon name="cilReportSlash" cTextColor="danger" size="lg"></svg>
                </label>
            </span>
        </c-col>
    </c-row>
    <!--Password-->
    <c-row class="mb-2" *ngIf="mode ==='create'">
        <c-col xs="12">
            <label style="width: 150px;">Password<span class="text-danger">*</span></label>
        </c-col>
        <c-col xs="12">
            <input class="form-control" placeholder formControlName="password" sizing="sm" cFormControl [ngClass]="{'is-invalid': this.userForm.get('password')?.invalid
        && this.userForm.get('password')?.touched}" maxlength="60" type="password" input-trimmer>
        </c-col>
        <c-col xs="12">
            <div *ngIf="this.userForm.get('password')?.errors?.['required'] && 
        (this.userForm.get('password')?.dirty ||this.userForm.get('password')?.touched)" class="text-danger mx-1">
                Password is required
            </div>
        </c-col>
    </c-row>
    <!--Address-->
    <c-card class="mb-2" [cBorder]="{top: {color: 'secondary', width: 3}}">
        <c-card-body>
            <h6 cCardSubtitle class="mb-2 text-medium-emphasis">Address</h6>
            <!--First Address-->
            <c-row class="mb-2">
                <c-col xl="12">
                    <label style="width: 150px;">First Address <span class="text-danger">*</span></label>
                </c-col>
                <c-col xl="12">
                    <input class="form-control" placeholder formControlName="first-address" sizing="sm" cFormControl
                        [ngClass]="{'is-invalid': this.userForm.get('first-address')?.invalid
                    && this.userForm.get('first-address')?.touched}" maxlength="60" input-trimmer>
                </c-col>
                <c-col xl=" 12">
                    <div *ngIf="this.userForm.get('first-address')?.errors?.['required'] && 
            (this.userForm.get('first-address')?.dirty ||this.userForm.get('first-address')?.touched)"
                        class="text-danger mx-1">
                        first address is required
                    </div>
                    <div *ngIf="this.userForm.get('first-address')?.errors?.['noSpecialCharacters']"
                        class="text-danger mx-1">first address cannot contain special characters.</div>
                </c-col>
            </c-row>
            <!--Second Address-->
            <c-row class="mb-2">
                <c-col xl="12">
                    <label style="width: 150px;">Second Address</label>
                </c-col>
                <c-col xl="12">
                    <input class="form-control" placeholder formControlName="second-address" sizing="sm" cFormControl
                        [ngClass]="{'is-invalid': this.userForm.get('second-address')?.invalid
                    && this.userForm.get('second-address')?.touched}" maxlength="60" input-trimmer>
                </c-col>
                <c-col xl=" 12">
                    <div *ngIf="this.userForm.get('second-address')?.errors?.['noSpecialCharacters']"
                        class="text-danger mx-1">second address cannot contain special characters.</div>
                </c-col>
            </c-row>
            <!--City-->
            <c-row class="mb-2">
                <c-col xl="12">
                    <label style="width: 150px;">City<span class="text-danger">*</span></label>
                </c-col>
                <c-col xl="12">
                    <input class="form-control" placeholder formControlName="city-address" sizing="sm" cFormControl
                        [ngClass]="{'is-invalid': this.userForm.get('city-address')?.invalid
                    && this.userForm.get('city-address')?.touched}" maxlength="60" input-trimmer>
                </c-col>
                <c-col xl=" 12">
                    <div *ngIf="this.userForm.get('city-address')?.errors?.['required'] && 
            (this.userForm.get('city-address')?.dirty ||this.userForm.get('city-address')?.touched)"
                        class="text-danger mx-1">
                        City is required
                    </div>
                    <div *ngIf="this.userForm.get('city-address')?.errors?.['noSpecialCharacters']"
                        class="text-danger mx-1">City cannot contain special characters.</div>
                </c-col>
            </c-row>
            <!--state-->
            <c-row class="mb-2">
                <c-col xl="12">
                    <label style="width: 150px;">State<span class="text-danger">*</span></label>
                </c-col>
                <c-col xl="12">
                    <select cSelect sizing="sm" formControlName="state-address">
                        <option value="null">Select State</option>
                        <option *ngFor="let state of states" [value]="state">
                            {{state}}
                        </option>
                    </select>
                </c-col>
                <c-col xs="12">
                    <div *ngIf="!this.userForm.get('state-address')?.valid && 
                        (this.userForm.get('state-address')?.dirty ||this.userForm.get('state-address')?.touched)"
                        class="text-danger mx-1">
                        State is required
                    </div>
                </c-col>
            </c-row>
            <!--Zip Code-->
            <c-row class="mb-2">
                <c-col xs="12"><label style="width: 150px;">ZipCode <span class="text-danger">*</span></label></c-col>
                <c-col xs="12">
                    <input class="form-control" placeholder formControlName="zipcode-address" zipcode maxlength="10"
                        sizing="sm" cFormControl [ngClass]="{'is-invalid': this.userForm.get('zipcode-address')?.invalid
                    && this.userForm.get('zipcode-address')?.touched}">
                </c-col>
                <c-col xs="12">
                    <div *ngIf="this.userForm.get('zipcode-address')?.errors?.['required'] === true && 
                (this.userForm.get('zipcode-address')?.dirty ||this.userForm.get('zipcode-address')?.touched)"
                        class="text-danger mx-1">
                        ZipCode Required
                    </div>
                    <div *ngIf="userForm.get('zipcode-address')?.errors?.['pattern']" class="text-danger mx-1">
                        Invalid ZipCode
                    </div>
                </c-col>
            </c-row>
        </c-card-body>
    </c-card>
    <!--User Role-->
    <c-card class="mb-2" [cBorder]="{top: {color: 'secondary', width: 3}}">
        <c-card-body>
            <h6 cCardSubtitle class="mb-2 text-medium-emphasis">User Role</h6>
            <c-row>
                <c-col xs="12">
                    <select cSelect sizing="sm" formControlName="userRole" sizing="sm">
                        <option value="null">Select Role</option>
                        <option *ngFor="let role of userRoles" [value]="role.value">
                            {{role.name}}
                        </option>
                    </select>
                </c-col>
                <c-col xs="12">
                    <div *ngIf="!this.userForm.get('userRole')?.valid && 
                        (this.userForm.get('userRole')?.dirty ||this.userForm.get('userRole')?.touched)"
                        class="text-danger mx-1">
                        user role is required
                    </div>
                </c-col>
            </c-row>
        </c-card-body>
    </c-card>
    <!--Clinics-->
    <c-card class="mb-2" [cBorder]="{top: {color: 'secondary', width: 3}}">
        <c-card-body>
            <h6 cCardSubtitle class="mb-2 text-medium-emphasis">Clinics</h6>
            <c-row>
                <c-col xs="12">
                    <c-multi-select multiple cSelect sizing="sm" formControlName="clinics">
                        <c-multi-select-option *ngFor="let clinic of (clinics$ |async)" [value]="clinic.id?.toString()"
                            [selected]="clinic.selected">{{clinic.name}}</c-multi-select-option>
                    </c-multi-select>
                </c-col>
                <c-col xs="12">
                    <div *ngIf="this.userForm.get('clinics')?.errors?.['required'] && 
                        (this.userForm.get('clinics')?.touched)" class="text-danger mx-1">
                        Clinics is required
                    </div>
                </c-col>
            </c-row>
        </c-card-body>
    </c-card>
    <!--Buttons-->
    <div class="mt-3 mb-2 text-center">
        <button cButton size="sm" variant="outline" class="mx-2" (click)="create()">
            <span *ngIf="!selectedUser">Create</span>
            <span *ngIf="selectedUser">Update</span>
        </button>
    </div>
</form>